@using BugTracker.Helpers;
@using Microsoft.AspNet.Identity;

@model BugTracker.Models.TicketViewModel

@{
    var userId = User.Identity.GetUserId();
    var projectHelper = new ProjectHelper();
}


@using (Html.BeginForm("Edit", "Tickets", FormMethod.Post))
{
    @Html.AntiForgeryToken();
    @Html.HiddenFor(model => model.Id);
    @Html.HiddenFor(model => model.ProjectId);
    @Html.HiddenFor(model => model.Created);
    @Html.HiddenFor(model => model.CurrentAssignee);
    @Html.HiddenFor(model => model.CurrentStatusId);
    <tr>
        <td>@Model.Submitter</td>
        @if (Model.CurrentAssignee == null)
        {
            <td>Unassigned</td>
        }
        else
        {
            <td>@Model.CurrentAssignee</td>
        }
        <td>@Model.CurrentStatusId</td>
        @if (projectHelper.IsUserOnProject(userId, Model.ProjectId))
        {
            <td>
                @Html.DropDownList("Priorities", Model.Priorities, new { @class = "form-control" })
            </td>
            <td>
                @Html.DropDownList("Types", Model.Types, new { @class = "form-control" })
            </td>
            <td>
                @Html.TextBoxFor(model => model.Description, new { @class = "form-control" })
            </td>
        }
        else
        {
            <td>@Model.CurrentPriorityId</td>
            <td>@Model.CurrentTypeId</td>
            <td>@Model.Description</td>
        }
        <td>@Model.Created.ToString("MM/d/yyyy")</td>
        <td>@Model.Updated</td>
    </tr>
    <input type="submit" value="Edit" class="btn pull-right" />
}
